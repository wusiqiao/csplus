<?php
/**
 * Created by PhpStorm.
 * User: Administrator
 * Date: 2018/3/5
 * Time: 14:43
 */

namespace ESAdmin\Controller;


use Common\Lib\Controller\DataController;

class ComBannerController extends DataController
{
    protected function _before_list(&$list)
    {
        parent::_before_list($list); // TODO: Change the autogenerated stub
        foreach($list as $key=>$val){
//            $list[$key]['updated_at'] = date('Y年m月d日 H:i:s',$val['updated_at']);
            $list[$key]['view_show']  = $this->getBannerTypeName($val['view']);
            if($val['url_switch'] == 1 && $val['url_type'] == 0){
                if(strpos($val['url'],'/uploads') === false && strpos($val['url'],'caisuikx') === false && strpos($val['url'],'http') === false){
                    $list[$key]['url'] =  'http://'.$val['url'];

                }
            }elseif($val['url_switch'] == 1 && $val['url_type'] == 1){
                $list[$key]['url'] =  'http://eshop.caisuikx.com/Index/showBannerPage/id/'.$val['id'];
            }else{
                $list[$key]['url'] = '';
            }
        }

    }

    protected function _before_write($type, &$data)
    {
        parent::_before_write($type, $data); // TODO: Change the autogenerated stub
        $data['updated_at'] = time();
        $data['created_at'] = time();
//        var_dump($data);die;
    }

    /*
     * 在模板渲染成功前载入所需数据
     */
    protected function _before_display_dataview(&$data) {
        parent::_before_display_dataview($data);
        $this->assign("banner_type", $this->getBannerTypeShow());
    }
    protected function getBannerTypeShow(){
        $banner = [
            ['name'=>'首页','key'=>'homepage']
        ];
        return $banner;
    }
    protected function getBannerTypeList($inc = 'all'){
        $banner = [
            'homepage' => '首页'
        ];

        return $inc == 'all' ? $banner : $banner[$inc];
    }
    protected function getBannerTypeName($inc){
        return $this->getBannerTypeList($inc);
    }
    protected function _getLastData($id) {
        return D(CONTROLLER_NAME)->field("content", true)->where("id=$id")->find();
    }
    protected function _before_detail(&$data)
    {
        parent::_before_detail($data); // TODO: Change the autogenerated stub
        if(ACTION_NAME == 'add'){
            unset($data['content']);
        }
    }
}