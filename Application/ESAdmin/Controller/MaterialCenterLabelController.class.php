<?php
/**
 * @auhor kcg
 * */
namespace ESAdmin\Controller;

use Common\Lib\Controller\DataController;

/**
 *图文中心 标签与配置--管理
 * */
class MaterialCenterLabelController extends DataController
{
    public function assignPermissions($controller = CONTROLLER_NAME)
    {
        parent::assignPermissions($controller); // TODO: Change the autogenerated stub
        $config = D('MaterialCenterConfig')->getConfig();
        $this->assign('config', $config);
    }

    public function updatStatusAction($id)
    {
        $id = intval($id);
        if ($id < 1) {
            $this->ajaxReturn(['error' => 400, 'message' => '数据异常']);
        }

        if (!D(CONTROLLER_NAME)->updateStatus($id)) {
            $this->ajaxReturn(['error' => 400, 'message' => '更新失败!']);
        }

        $this->ajaxReturn(['error' => 0, 'message' => '更新成功!']);
    }

    public function updateConfigAction()
    {
        $data = I('post.data');
        $model = D('MaterialCenterConfig');
        $model->startTrans();
        foreach ($data as $item) {
            $id = $item['id'];
            unset($item['id']);
            $item['update_time'] = time();
            if (!$model->where(['id' => $id])->save($item)) {
                $model->rollback();
                $this->ajaxReturn(['error' => 400, 'message' => '更新失败!']);
            }
        }

        $model->commit();
        $this->ajaxReturn(['error' => 0, 'message' => '更新成功!']);
    }

    public function _before_add(&$data)
    {
        parent::_before_add($data); // TODO: Change the autogenerated stub
    }
}
