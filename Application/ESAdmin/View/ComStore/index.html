<style>
    .important{
        color: red;
        font-size: 22px;
        padding: 5px;
        margin-right: 0px
    }
    .grey{
        color: grey;
        margin-left: 15px
    }

    .demo--label{margin:20px 20px 0 0;display:inline-block}
    .demo--radio{display:none}
    .demo--radioInput{background-color:#fff;border:2px solid rgba(0,0,0,0.15);border-radius:100%;display:inline-block;height:20px;margin-right:10px;margin-top:-1px;vertical-align:middle;width:20px;line-height:1}
    .demo--radio:checked + .demo--radioInput:after{background-color:#00A1E9;border-radius:100%;content:"";display:inline-block;height:10px;margin-left:5px;margin-top:5px;width:10px}
    .demo--checkbox.demo--radioInput,.demo--radio:checked + .demo--checkbox.demo--radioInput:after{border-radius:0}
    .demo--radio:checked + .demo--radioInput{border:2px solid #00A1E9;}
    .tree {
        max-height: 460px;
        overflow-y: auto;
    }
</style>
<div class="detailcontainer" id="{$Think.const.CONTROLLER_NAME}-detailcontainer" style="margin: 10px;background: #fff;width:75%;border:1px solid #ccc;">
    <form action="ComStore/{$Think.__FORM_ACTION__}" id="{$Think.const.CONTROLLER_NAME}-dataform" method="post" name="{$Think.const.CONTROLLER_NAME}-dataform">
        <div class="easyui-section" style="padding-bottom: 20px">
            <div class="easyui-section-item" style="padding-left:0px">
                <div class="tab-header"><span>基础信息</span></div>
                <div class="tableForm" style="padding-left:30px">
                    <input name="id"  type="hidden"  value="{$model.id}">
                    <div class="row" style="width: 800px;margin-bottom: 20px;padding-top:10px">
                        <div class="caption block" ><span class="important" style="padding-right: 17px">*</span><span>{$Think.lang.STORE_NAME}：</span></div>
                        <div class="inputbox"><input name="name" class="easyui-validatebox" data-options="required:true" value="{$model.name}" /></div>
                        <span class="grey">请输入商城名称,不超过15个字</span>
                    </div>
                    <div class="row" style="width: 800px;margin-bottom: 20px">
                        <div class="caption block"><span class="important">*</span><span>{$Think.lang.DEFAULT_HEADER_PIC}：</span></div>
                        <div class="inputbox" style="margin-right: 10px">
                            <input type="text" class="easyui-validatebox" id="default_header_pic" data-options="required:true" name="default_header_pic"  value="{$model.default_header_pic}"/>
                        </div>
                        <a href="javascript:void(0);" class="  common-blue-btn detail-edit" onclick="upImage();">上传图片</a>
                        <span class="grey">图片建议尺寸：120*120像素</span>
                        <!--<a href="{$model.default_header_pic}"
                           class="easyui-linkbutton fontawesome-icon-button"
                           plain="true"
                           target="_blank"
                        <empty name="model.default_header_pic">
                            style="display: none"
                        </empty>
                        id="show_pic">查看图片</a>-->
                    </div>
                    <div class="row" style="width: 800px;margin-bottom: 20px">
                        <div class="caption block"><span class="important" style="padding-right: 18px">*</span><span>{$Think.lang.STORE_SHARE_DESC}：</span></div>
                        <div class="inputbox "><textarea name="share_desc" rows="5" cols="52" data-options="required:true" class="easyui-validatebox" >{$model.share_desc}</textarea></div>
                        <span class="grey block" style="padding-left: 125px">微信分享时显示的描述内容</span>
                    </div>
                    <div class="row" style="width: 800px;margin-bottom: 20px">
                        <div class="caption block"><span class="important" style="padding-right: 18px">*</span><span>{$Think.lang.STORE_TEL}：</span></div>
                        <div class="inputbox"><input name="tel" class="easyui-validatebox" data-options="required:true" value="{$model.tel}" /></div>
                        <span class="grey block" >显示在商城首页的联系电话</span>
                    </div>
                    <!--
                    <div class="row" style="width: 800px;margin-bottom: 20px">
                        <div class="caption"><span class="important" style="padding-right: 18px">*</span><span>{$Think.lang.UNLINE_PAYEE}：</span></div>
                        <div class="inputbox"><input name="unline_payee" class="easyui-validatebox" data-options="required:true" value="{$model.unline_payee}" /></div>
                        <span class="grey block" >线下转账收款账户名,如欧阳菲菲</span>
                    </div>
                    <div class="row" style="width: 800px;margin-bottom: 20px">
                        <div class="caption"><span class="important" style="padding-right: 33px">*</span><span>{$Think.lang.UNLINE_BANK_ACCOUNT}：</span></div>
                        <div class="inputbox"><input name="unline_bank_account" class="easyui-validatebox"  value="{$model.unline_bank_account}" /></div>
                        <span class="grey block" >线下转账收款账户开户行,如XX银行</span>
                    </div>
                    <div class="row" style="width: 800px;margin-bottom: 20px">
                        <div class="caption"><span class="important" style="padding-right: 20px">*</span><span>{$Think.lang.UNLINE_CARD_NUMBER}：</span></div>
                        <div class="inputbox"><input name="unline_card_number" class="easyui-validatebox" data-options="required:true" value="{$model.unline_card_number}" /></div>
                        <span class="grey block" >线下转账收款账号</span>
                    </div>

                    -->
                    <div class="row" style="width: 800px;margin-bottom: 20px">
                        <div class="caption"><span>{$Think.lang.STORE_CONTACT}：</span></div>
                        <div class="inputbox"><input name="contacts" class="easyui-validatebox"  value="{$model.contacts}" /></div>
                    </div>
                    <div class="row" style="width: 800px;margin-bottom: 20px">
                        <div class="caption"><span>{$Think.lang.STORE_EMAIL}：</span></div>
                        <div class="inputbox"><input name="email" class="easyui-validatebox"  data-options="validType:'email'"  value="{$model.email}" /></div>
                    </div>
                    <div class="row" style="width: 800px;margin-bottom: 20px">
                        <div class="caption"><span class="important" style="padding-right: 20px;width:270px;">*</span><span>{$Think.lang.STORE_CITY}：</span></div>
                        <input id="cc" style="width:270px;" value="" data-value="{$model.store_city}" name="store_city" >
                    </div>
                    <div class="row" style="width: 800px;margin-bottom: 20px">
                        <div class="caption block"><span>{$Think.lang.STORE_ADDRESS}：</span></div>
                        <div class="inputbox"><textarea name="address"  rows="2" cols="37" class="easyui-validatebox">{$model.address}</textarea></div>
                    </div>
                    <div class="row" style="width: 800px;margin-bottom: 20px">
                        <div class="caption "><span>{$Think.lang.STORE_MAP}：</span></div>
                        <input class="easyui-validatebox" style="width: 60%;margin-right: 15px" type="hidden" value="{$model.map_location}" name="map_location"/>
                        <div class="inputbox_x2"><input class="easyui-validatebox" style="width: 275px;margin-right: 15px" readonly value="{$model.map_address}" name="map_address" placeholder="您暂未设置地图的所在位置"/>
                            <a href="javascript:void(0)" class="common-blue-btn detail-edit map-edit-botton " plain="true">设置地图</a></div>
                    </div>
                    <!--<div class="row">
                        <div class="caption"><span>{$Think.lang.STORE_MOBILE}：</span></div>
                        <div class="inputbox"><input name="mobile" class="easyui-validatebox"  data-options="validType:'mobile'" value="{$model.mobile}" /></div>
                        <div class="caption"><span>{$Think.lang.STORE_TEL}：</span></div>
                        <div class="inputbox"><input name="tel" class="easyui-validatebox"  value="{$model.tel}" /></div>
                    </div>
                    -->
                </div>
            </div>
            <div class="easyui-section">
                        <!--<input name="id"  type="hidden"  value="{$model.id}">-->
                        <div class="easyui-section-item">
                            <div class="tab-header"><span>工具管理</span></div>
                            <div class="tableForm">
                                <div class="row" style="width: 800px;margin-bottom: 20px">
                                    <div class="caption" style="width: 150px">免费核名 ：</div>

                                    <label class="demo--label">
                                        <input class="demo--radio" type="radio" name="tool_manager[nuclear]" value="nuclear" id="nuclear1">
                                        <span class="demo--radioInput"></span>显示
                                    </label>
                                    <label>
                                        <input class="demo--radio" type="radio" name="tool_manager[nuclear]" id="nuclear2">
                                        <span class="demo--radioInput"></span>隐藏
                                    <!--显示  <input type="radio" class="demo&#45;&#45;radio" name="tool_manager[nuclear]" value="nuclear" id="nuclear1">
                                    隐藏  <input type="radio" class="demo&#45;&#45;radio" name="tool_manager[nuclear]" id="nuclear2">-->
                                    </label>
                                    <span style="color: grey;margin-left: 20px">选择隐藏，将不在首页展示该功能入口</span>
                                </div>
                                <div class="row" style="width: 800px;margin-bottom: 20px">
                                    <div class="caption" style="width: 150px">商标查询 ：</div>
                                    <label>
                                        <input class="demo--radio" type="radio" value="trademarks" name="tool_manager[trademarks]" id="trademarks1">
                                        <span class="demo--radioInput"></span>显示
                                    </label>
                                    <label style="padding-left: 20px">
                                        <input class="demo--radio" type="radio" name="tool_manager[trademarks]" id="trademarks2">
                                        <span class="demo--radioInput"></span>隐藏
                                    </label>
                                    <span style="color: grey;margin-left: 20px">选择隐藏，将不在首页展示该功能入口</span>
                                </div>
                                <div class="row" style="width: 800px;margin-bottom: 20px">
                                    <div class="caption" style="width: 150px">免费文档 ：</div>
                                    <label>
                                        <input class="demo--radio" type="radio" value="files" name="tool_manager[files]" id="files1"">
                                        <span class="demo--radioInput"></span>显示
                                    </label>
                                    <label style="padding-left: 20px">
                                        <input class="demo--radio" type="radio" name="tool_manager[files]" id="files2">
                                        <span class="demo--radioInput"></span>隐藏
                                    </label>
                                    <span style="color: grey;margin-left: 20px" >选择隐藏，将不在首页展示该功能入口</span>
                                </div>
                            </div>
                        </div>
                    </div>
            <!--<div class="easyui-section">
                &lt;!&ndash;<input name="id"  type="hidden"  value="{$model.id}">&ndash;&gt;
                <div class="easyui-section-item">
                    <div class="tab-header"><span>订单设置</span></div>
                    <div class="tableForm">
                        <div class="row" style="width: 800px;margin-bottom: 20px">
                            <input type="hidden" value="{$model.is_auto_agreement}" name="is_auto_agreement">
                            <div class="caption" style="width: 150px">订单自动生成合同 ：</div>
                            <label class="demo&#45;&#45;label">
                                <input class="demo&#45;&#45;radio" type="radio" name="is_auto_agreement" value="1" id="agreement1">
                                <span class="demo&#45;&#45;radioInput"></span>开启
                            </label>
                            <label>
                                <input class="demo&#45;&#45;radio" type="radio" name="is_auto_agreement" id="agreement2">
                                <span class="demo&#45;&#45;radioInput"></span>不开启
                            </label>
                            <span style="color: grey;margin-left: 20px"></span>
                        </div>
                    </div>
                </div>
            </div>-->
            <div class="easyui-section-item" >
                <div class="tab-header" style="position: relative">
                    <span>{$Think.lang.STORE_DESC}</span>
                    <div style="position: absolute;right:10px;top:2px"><a href="javascript:void(0)" class="common-blue-btn detail-edit editor-edit-botton" plain="true">编辑</a></div>
                </div>
                <div style="padding-left: 15px" >
                    <div class="maincontainer" style="height:400px;overflow: auto">
                        <div id="store-content">{$model.remark|html_entity_decode}</div>
                        <input name="remark" type="hidden" value="{$model.remark}"/>
                    </div>
                </div>
            </div>
            <!--<div class="easyui-section-item">
                <div class="tab-header"><span>案例</span></div>
                <div title="子表内容" style="padding-top: 0px;" >
                    <div class="maincontainer" style="height:400px">
                        <include file="./Application/Common/Layout/Default/detail_header.html"  controller="ComStoreCase" />
                        <tr>
                            <th data-options="field:'id',hidden:true"></th>
                            <th data-options="field:'parent_id',hidden:true,editor:{type:'numberbox'}"></th>
                            <th data-options="field:'row_no',hidden:true,width:50,align:'center',editor:{type:'numberbox'}">{$Think.lang.FLD_SORT}</th>
                            <th data-options="field:'name',width:'20%',align:'left',editor:{type:'validatebox', options: {required: true}}">案例名称</th>
                            <th data-options="field:'case_desc',width:'50%',align:'left',editor:{type:'validatebox', options: {required: true}}">案例简介</th>
                        </tr>
                        </thead></table>
                    </div>
                </div>
            </div>-->



            <div class="form-actions" id='{$Think.const.CONTROLLER_NAME}-form-actions'>
            <div class='actions-sysdefault' style="margin-top: 10px">
                <if condition="($permissions.update eq 1) OR ($permissions._IS_ADMIN_ eq 1) ">
                    <a href="javascript:void(0)" class="easyui-linkbutton fontawesome-icon-button" plain="true" icon="fa-save fa-lg"  onclick="saveComStoreForm()">保存</a>
                </if>
                <!--<a href="javascript:void(0)" class="easyui-linkbutton fontawesome-icon-button bg_red" plain="true" icon="fa-remove fa-lg" onclick="closeDialog('[controller]')">关闭</a>-->
                </div>
            </div>
        </div>
    </form>
</div>
<script src="{$Think.const.JS_URL}ajaxfileupload.js" type="text/javascript"></script>
<!--添加上传图片 start-->
<script type="text/javascript" src="__ROOT__/{$Think.MODULE_PATH}Public/editorUploadImages/js/ueditor.config.js"></script>
<script type="text/javascript" src="__ROOT__/{$Think.MODULE_PATH}Public/editorUploadImages/js/ueditor.all.js"></script>
<script type="text/plain" id="upload_ue"></script>
<script type="text/plain" id="upload_ue2"></script>
<script type="text/javascript">
    var nuclear = $('input[name="tool_manager[nuclear]"]');
    var trademarks = $('input[name="tool_manager[trademarks]"]');
    var files = $('input[name="tool_manager[files]"]');
    $(function(){
        var tool_manager = '{$model.tool_manager}';
        var tools = tool_manager.split(",");
        if($.inArray('nuclear',tools) != -1){
            nuclear.eq(0).attr("checked",true);
        }else{
            nuclear.eq(1).attr("checked",true);
        }
        if($.inArray('trademarks',tools) != -1){
            trademarks.eq(0).attr("checked",true);
        }else{
            trademarks.eq(1).attr("checked",true);
        }
        if($.inArray('files',tools) != -1){
            files.eq(0).attr("checked",true);
        }else{
            files.eq(1).attr("checked",true);
        }
    });

    $(function(){
        var is_suto_agreement = $("input[name='is_auto_agreement']").val();
        if(is_suto_agreement == 0){
            $("#agreement2").attr("checked",true);
        }else{
            $("#agreement1").attr("checked",true);
        }
        $("#agreement1").on("change",function(){
            $("input[name='is_auto_agreement']").val("1");
        })
        $("#agreement2").on("change",function(){
            $("input[name='is_auto_agreement']").val("0");
        })
    });

    var defaultCity = $('#cc').data('value');
    $(function(){
        var $dataform = getDataForm("{$Think.const.CONTROLLER_NAME}");
         $dataform.find(".editor-edit-botton").click(function(){
            var source = $("#store-content").html();
            openEditor("简介编辑", source, function(content){
               $("#store-content").html(content);
               $dataform.find("input[name=remark]").val(content);
            });
        });
        $dataform.find(".map-edit-botton").click(function(){
            var data = {
                address : $dataform.find("input[name=map_address]").val(),
                location : $dataform.find("input[name=map_location]").val(),
            }
            openMAP("地图", data, function(data){
                $dataform.find("input[name=map_address]").val(data.address);
                $dataform.find("input[name=map_location]").val($.trim(data.location.split(',')[0])+','+$.trim(data.location.split(',')[1]));
            });
        });
        $("#ComStoreCase-datagrid").gridtoolbar({
            queryParams: {
                'q-parent_id': $dataform.find("input[name=id]").val()  //过滤
            }, 
            mainForm: $dataform,  //对应Form
            allowEmpty: true,  //是否可以为空
            name: "Case"  //主表Model定义children时唯一标示
        });
        $('#cc').combotree({
            url: '__MODULE__/ComStore/getCityTree/cid/'+defaultCity,
            required: true,
            valueField: 'id',
            textField: 'text',
            // onlyLeafCheck: true,
            // lines: true,
            cascadeCheck: true,
            onLoadSuccess: function (node, data) {
                var TheValue = $('#cc').data('value');
                if(TheValue > 0){
                    $("#cc").combotree('setValue',TheValue);
                }
            },onBeforeSelect:function(node){
                if(node.children){
                    $("#cc").tree("unselect");
                }
            }
        });
    });
    
    function saveComStoreForm(){
        if(nuclear.eq(1).attr("checked")){
            nuclear.eq(1).attr("name","");
        }
        if(trademarks.eq(1).attr("checked")){
            trademarks.eq(1).attr("name","");
        }
        if(files.eq(1).attr("checked")){
            files.eq(1).attr("name","");
        }
        showMaskLayer();     
        var dataForm = getDataForm("ComStore");
        dataForm.trigger("Update");//触发子表grid获取数据，如果没有子表，不需要触发。
        dataForm.form('submit', {
            url: dataForm.attr("action"),
            onSubmit:function(){
                var validate = $(this).form('validate');
                if (!validate){
                    hideMaskLayer();
                    //$.dialog.alert("请输入必填项！");
                }
                return validate;
            },
            success: function (ret) {

                var result = $.parseJSON(removeJsonQuote(ret));
                if (result.code === 0) {
                    $.dialog.tips("保存成功！"); 
                    //刷新窗体
                    getLogoImg();
                    dataForm.find("input[name=id]").val(result.message.id);
                    dataForm.attr("action", "ComStore/update");
                } else {
                    $.dialog.tips(result.message);
                }
                hideMaskLayer();
                if(nuclear.eq(1).attr("checked")){
                    nuclear.eq(1).attr("name","tool_manager[nuclear]");
                }
                if(trademarks.eq(1).attr("checked")){
                    trademarks.eq(1).attr("name","tool_manager[trademarks]");
                }
                if(files.eq(1).attr("checked")){
                    files.eq(1).attr("name","tool_manager[files]");
                }
            }
        });
    }

</script>
<script type="text/javascript">
    var _editor;
    var _editor2;
    $(function() {
        //重新实例化一个编辑器，防止在上面的editor编辑器中显示上传的图片或者文件
        _editor = UE.getEditor('upload_ue',
            {
                upload_model: "default_images",
                UEDITOR_HOME_URL:'__ROOT__Application/ESAdmin/Public/editorUploadImages/js/',
            });
        _editor.ready(function () {
            //隐藏编辑器，因为不会用到这个编辑器实例，所以要隐藏
            _editor.hide();
            //侦听图片上传
            _editor.addListener('beforeInsertImage', function (t, arg) {
                //将地址赋值给相应的input,只去第一张图片的路径
                $("#default_header_pic").attr("value", arg[0].src);
                //图片预览
                $("#show_pic").attr("href", arg[0].src);
                $("#show_pic").show();
            })
        });
        //重新实例化一个编辑器，防止在上面的editor编辑器中显示上传的图片或者文件
        _editor2 = UE.getEditor('upload_ue2',
            {
                upload_model: "login_pic",
                UEDITOR_HOME_URL:'__ROOT__Application/ESAdmin/Public/editorUploadImages/js/',
            });
        _editor2.ready(function () {
            //隐藏编辑器，因为不会用到这个编辑器实例，所以要隐藏
            _editor2.hide();
            //侦听图片上传
            _editor2.addListener('beforeInsertImage', function (t, arg) {
                //将地址赋值给相应的input,只去第一张图片的路径
                $("#login_interface_pic").attr("value", arg[0].src);
                //图片预览
                $("#show_pic2").attr("href", arg[0].src);
                $("#show_pic2").show();
            })
        });
    });
    //弹出图片上传的对话框
    function upImage() {
        var myImage = _editor.getDialog("insertimage");
        myImage.open();
    }
    //弹出图片上传的对话框
    function upImage2() {
        var myImage = _editor2.getDialog("insertimage");
        myImage.open();
    }
</script>
